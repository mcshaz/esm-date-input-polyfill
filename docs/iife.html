<!DOCTYPE html>
<html >
  <head>
    <meta charset="UTF-8">
    <title>nodep Polyfill Test</title>
    <meta name="description" content="nodep Polyfill Test">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="esm-date-input-polyfill/dist/esm-date-input-polyfill.js" ></script>
  </head>
  <body>
    <h2>Using IIFE</h2>
    <form>
      <div data-force-date-input-polyfill>
        <fieldset>
          <legend>Empty Date No Min/Max</legend>
          <p>
            <label>Date:
              <input type="date" id="simple-date">
            </label>
          </p>
          <p>
            <label>value:
              <output class="date-value" for="simple-date"></output>
            </label>
          </p>
          <p>
            <label>valueAsDate: 
              <output class="value-as-date" for="simple-date"></output>
            </label>
          </p>
        </fieldset>
        
        <fieldset>
          <legend>With Value and Min/Max Attributes</legend>
          <p>
            <label>Date:
              <input type="date" id="value-attr-date" value="2020-04-05" min="2020-04-03" max="2020-04-07" lang="de-DE">
            </label>
            this should have the current date 2020-04-05 and only allow a minimum date of 2020-04-03 and maximum 2020-04-07.
          </p>
          <p>
            <label>value:
              <output class="date-value" for="value-attr-date"></output>
            </label>
          </p>
          <p>
            <label>valueAsDate: 
              <output class="value-as-date" for="value-attr-date"></output>
            </label>
          </p>
        </fieldset>

        <fieldset>
          <legend>Dynamically Created</legend>
          <p>
            <label id="dynamic-create-date">Date:
            </label>
          </p>
          <p>
            <label>value:
              <output class="date-value" for="dynamic-date"></output>
            </label>
          </p>
          <p>
            <label>valueAsDate: 
              <output class="value-as-date" for="dynamic-date"></output>
            </label>
          </p>
        </fieldset>
      </div>
      <fieldset>
        <legend>native date input (if supported):</legend>
        <p>
          <label>Date:
            <input type="date" id="native-date" value="2020-04-05" min="2020-04-03" max="2020-04-07" lang="de-DE" >
          </label>
            this should have the current date 2020-04-05 and only allow a minimum date of 2020-04-03 and maximum 2020-04-07.
        </p>
        <p>
          <label>value:
            <output class="date-value" for="native-date"></output>
          </label>
        </p>
        <p>
          <label>valueAsDate: 
            <output class="value-as-date" for="native-date"></output>
          </label>
        </p>
      </fieldset>
      <input type="submit">
    </form>
    <script>
      (function() {
        dateInputPolyfill.polyfillIfRequired({watchForInsert: true, allowForcePicker: true});

        var outputs = document.getElementsByTagName('output');
        outputs.forEach(watchDates);

        // dynamically create date element
        setTimeout(function() {
            var inpt = document.createElement("input");
            inpt.setAttribute("type", "date");
            inpt.setAttribute("id", "dynamic-date");
            document.getElementById("dynamic-create-date").appendChild(inpt);
            Array.prototype.filter.call(outputs, function(o) { return o.getAttribute('for') === 'dynamic-date' }).forEach(watchDates);
          }, 500);
        
        function watchDates(o) {
          var outputFor = document.getElementById(o.getAttribute('for'));
          if (outputFor) {
            var onInput = o.className === 'date-value'
              ? function(el) { o.innerHTML = el.target.value; }
              : function(el) { o.innerHTML = String(el.target.valueAsDate); };
            outputFor.addEventListener('input', onInput);
          }
        }
      })();
    </script>
  </body>
</html>